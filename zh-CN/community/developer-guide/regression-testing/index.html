<!doctype html>
<html lang="zh-Hans-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-community docs-doc-id-developer-guide/regression-testing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<meta name="generator" content="Docusaurus v2.4.3">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache Doris RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache Doris Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DT7W9E9722"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DT7W9E9722",{anonymize_ip:!0})</script>






<link rel="icon" href="/zh-CN/images/logo-only.png">
<link rel="manifest" href="/zh-CN/manifest.json">
<meta name="theme-color" content="#FFFFFF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/zh-CN/img/docusaurus.png">
<link rel="mask-icon" href="/zh-CN/img/docusaurus.svg" color="rgb(37, 194, 160)">
<meta name="msapplication-TileImage" content="/zh-CN/img/docusaurus.png">
<meta name="msapplication-TileColor" content="#000">


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:500">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:400"><title data-rh="true">回归测试 - Apache Doris</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doris.apache.org/zh-CN/community/developer-guide/regression-testing"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-community-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-community-current"><meta data-rh="true" property="og:title" content="回归测试 - Apache Doris"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/zh-CN/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://doris.apache.org/zh-CN/community/developer-guide/regression-testing"><link data-rh="true" rel="alternate" href="https://doris.apache.org/community/developer-guide/regression-testing" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://doris.apache.org/zh-CN/community/developer-guide/regression-testing" hreflang="zh-Hans-CN"><link data-rh="true" rel="alternate" href="https://doris.apache.org/community/developer-guide/regression-testing" hreflang="x-default"><link rel="stylesheet" href="https://cdnd.selectdb.com/zh-CN/assets/css/styles.01ecd37f.css">
<link rel="preload" href="https://cdnd.selectdb.com/zh-CN/assets/js/runtime~main.f53d34ae.js" as="script">
<link rel="preload" href="https://cdnd.selectdb.com/zh-CN/assets/js/main.0e65d80f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="announcementBar_s0pr" style="background-color:#3C2FD4;color:#FFFFFF" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><div class="announcementBarContent_dpRF"><a href="https://github.com/apache/doris" target="_blank" style="display: flex; width: 100%; align-items: center; justify-content: center; margin-left: 4px; text-decoration: none; color: white">Do you like Apache Doris？Give us a 🌟 on GitHub 
                        <img style="width: 1.2rem; height: 1.2rem; margin-left: 0.4rem;" src="/images/github-white-icon.svg">
                    </a></div><button type="button" class="clean-btn close announcementBarClose_iXyO" aria-label="关闭"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://cdnd.selectdb.com/images/logo.svg" alt="Apache Doris" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" style="text-align:center" href="/zh-CN/">Home</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/dev/get-starting/what-is-apache-doris">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/learning">Learning Path</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/docs/dev/get-starting/quick-start">Getting Started</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/docs/dev/install/standard-deployment">Install and Deploy</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/docs/dev/faq/install-faq">FAQ</a></li></ul></div><a class="navbar__item navbar__link" style="text-align:center" href="/zh-CN/blog">Blogs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/community/join-community">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/join-community">Join Community</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/team">Doris Team</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/how-to-contribute/">How to Contribute</a></li><li><a class="dropdown__link" style="text-align:left" align="left" href="/zh-CN/community/developer-guide/debug-tool">Developer Guide</a></li></ul></div><a class="navbar__item navbar__link" style="text-align:center" href="/zh-CN/users">User Stories</a></div><div class="navbar__items navbar__items--right"><div class="versions">Version<!-- -->:<div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/dev/get-starting/quick-start">dev</a><ul class="dropdown__menu"><li><a class="dropdown__link" style="text-align:center" href="/zh-CN/docs/dev/get-starting/quick-start">dev</a></li><li><a class="dropdown__link" style="text-align:center" href="/zh-CN/docs/1.2/get-starting/">1.2</a></li></ul></div></div><div class="locale-box"><a href="/community/developer-guide/regression-testing" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link" style="text-align:center">EN</a><a href="/zh-CN/community/developer-guide/regression-testing" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link dropdown__link--active" style="text-align:center">中文</a></div><a class="navbar__item navbar__link header-right-button-primary navbar-download-mobile" style="text-align:center" href="/zh-CN/download">Download</a><div class="navbar-search searchBox_ZlJk"><div class="navbar__search searchBarContainer_PzyC"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing__K5d searchBarLoadingRing_e2f0"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_m7ml"><kbd class="searchHint_zuPL">ctrl</kbd><kbd class="searchHint_zuPL">K</kbd></div></div></div><span class="github-btn desktop header-right-button-github"><span class="github-btn github-btn-large"><a class="gh-btn" href="//github.com/apache/doris/" target="_blank"><span class="gh-ico" aria-hidden="true"></span><span class="gh-text">Star</span></a><a class="gh-count" target="_blank" href="//github.com/apache/doris/stargazers/"></a></span></span><a class="header-right-button-primary navbar-download-desktop" href="/zh-CN/download">Download</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><div class="main-wrapper docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar"><div class="doc-search"><div class="navbar__search searchBarContainer_PzyC"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing__K5d searchBarLoadingRing_e2f0"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_m7ml"><kbd class="searchHint_zuPL">ctrl</kbd><kbd class="searchHint_zuPL">K</kbd></div></div></div><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/community/join-community">加入 Doris 社区</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/community/team">Doris 团队</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/community/subscribe-mail-list">订阅邮件列表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/community/feedback">问题反馈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/community/doris-future">Doris 未来计划</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/community/how-to-contribute/">How to Contribute</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/community/release-and-verify/release-prepare">Release Process &amp; Verification</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/community/security">安全</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh-CN/community/design/doris_storage_optimization">Design Documents</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh-CN/community/developer-guide/debug-tool">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/debug-tool">调试工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/docker-dev">Doris Docker 快速搭建开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/benchmark-tool">Doris BE存储层Benchmark工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/fe-eclipse-dev">FE 开发环境搭建 - Eclipse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/fe-idea-dev">FE 开发环境搭建 - IntelliJ IDEA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/fe-vscode-dev">FE 开发环境搭建 - Visual Studio Code (VSCode)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/be-vscode-dev">Doris BE开发调试环境 -- vscode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/be-clion-dev">Doris BE 开发调试环境 -- clion</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/zh-CN/community/developer-guide/mac-dev/dev-prepare">Mac Local Dev</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/java-format-code">Java 代码格式化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/cpp-format-code">C++ 代码格式化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/cpp-diagnostic-code">C++ 代码分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/how-to-share-blogs">如何分享Blog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/bitmap-hll-file-format">Bitmap/HLL 数据格式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/community/developer-guide/github-checks">Github 准入检查</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/community/developer-guide/regression-testing">回归测试</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://cwiki.apache.org/confluence/display/DORIS/Doris+Improvement+Proposals" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Improvement Proposals<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">回归测试</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>回归测试</h1></header><h1>回归测试</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a href="#概念" class="hash-link" aria-label="概念的直接链接" title="概念的直接链接">​</a></h2><ol><li><code>Suite</code>: 一个测试用例，目前仅用来指代测试用例文件名</li><li><code>Group</code>: 一个测试集，目前仅用于指代测试用例所属的目录</li><li><code>Action</code>: 一个封装好的具体测试行为，比如用于执行sql的<code>sql</code> Action，用于校验结果的<code>test</code> Action，用于导入数据的<code>streamLoad</code> Action等</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试步骤">测试步骤<a href="#测试步骤" class="hash-link" aria-label="测试步骤的直接链接" title="测试步骤的直接链接">​</a></h2><ol><li>需要预先安装好集群</li><li>修改配置文件<code>${DORIS_HOME}/regression-test/conf/regression-conf.groovy</code>，设置jdbc url、用户等配置项</li><li>创建测试用例文件并编写用例</li><li>如果用例文件包含<code>qt</code> Action，则需要创建关联的data文件，比如<code>suites/demo/qt_action.groovy</code>这个例子，需要用到<code>data/demo/qt_action.out</code>这个TSV文件来校验输出是否一致</li><li>运行<code>${DORIS_HOME}/run-regression-test.sh</code>测试全部用例,或运行<code>${DORIS_HOME}/run-regression-test.sh --run &lt;suiteName&gt;</code> 测试若干用例，更多例子见&quot;启动脚本例子&quot;章节</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="目录结构">目录结构<a href="#目录结构" class="hash-link" aria-label="目录结构的直接链接" title="目录结构的直接链接">​</a></h2><p>开发时需要关注的重要文件/目录</p><ol><li><code>run-regression-test.sh</code>: 启动脚本</li><li><code>regression-conf.groovy</code>: 回归测试的默认配置</li><li><code>data</code>: 存放输入数据和输出校验数据</li><li><code>suites</code>: 存放用例</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">./${DORIS_HOME}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |-- **run-regression-test.sh**           回归测试启动脚本</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |-- regression-test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |-- plugins                          插件目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |-- conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |   |-- logback.xml                  日志配置文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |   |-- **regression-conf.groovy**   默认配置文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |-- framework                        回归测试框架源码</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |-- **data**                         用例的输入输出文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |   |-- demo                         存放demo的输入输出文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |   |-- correctness                  存放正确性测试用例的输入输出文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |   |-- performance                  存放性能测试用例的输入输出文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |   |-- utils                        存放其他工具的输入输出文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |   |-- **suites**                       回归测试用例</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |       |-- demo                         存放测试用例的demo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |       |-- correctness                  存放正确性测试用例</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |       |-- performance                  存放性能测试用例</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |       |-- utils                        其他工具</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    |-- output</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        |-- regression-test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            |-- log                          回归测试日志</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="框架默认配置">框架默认配置<a href="#框架默认配置" class="hash-link" aria-label="框架默认配置的直接链接" title="框架默认配置的直接链接">​</a></h2><p>测试时需要实际情况修改jdbc和fe的配置</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/* ============ 一般只需要关注下面这部分 ============ */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 默认DB,如果未创建,则会尝试创建这个db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">defaultDb = &quot;regression_test&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Jdbc配置</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jdbcUrl = &quot;jdbc:mysql://127.0.0.1:9030/?&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jdbcUser = &quot;root&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jdbcPassword = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// fe地址配置, 用于stream load</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">feHttpAddress = &quot;127.0.0.1:8030&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">feHttpUser = &quot;root&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">feHttpPassword = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/* ============ 一般不需要修改下面的部分 ============ */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// DORIS_HOME变量是通过run-regression-test.sh传入的</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 即 java -DDORIS_HOME=./</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 设置回归测试用例的目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">suitePath = &quot;${DORIS_HOME}/regression-test/suites&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 设置输入输出数据的目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dataPath = &quot;${DORIS_HOME}/regression-test/data&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 设置插件的目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pluginPath = &quot;${DORIS_HOME}/regression-test/plugins&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 默认会读所有的组,读多个组可以用半角逗号隔开，如: &quot;demo,performance&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 一般不需要在配置文件中修改，而是通过run-regression-test.sh --run -g来动态指定和覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">testGroups = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 默认会读所有的用例, 同样可以使用run-regression-test.sh --run -s来动态指定和覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">testSuites = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 默认会加载的用例目录, 可以通过run-regression-test.sh --run -d来动态指定和覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">testDirectories = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 排除这些组的用例，可通过run-regression-test.sh --run -xg来动态指定和覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">excludeGroups = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 排除这些suite，可通过run-regression-test.sh --run -xs来动态指定和覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">excludeSuites = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 排除这些目录，可通过run-regression-test.sh --run -xd来动态指定和覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">excludeDirectories = &quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 其他自定义配置</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">customConf1 = &quot;test_custom_conf_value&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="编写用例的步骤">编写用例的步骤<a href="#编写用例的步骤" class="hash-link" aria-label="编写用例的步骤的直接链接" title="编写用例的步骤的直接链接">​</a></h2><ol><li>进入<code>${DORIS_HOME}/regression-test</code>目录</li><li>根据测试的目的来选择用例的目录，正确性测试存在<code>suites/correctness</code>，而性能测试存在<code>suites/performance</code></li><li>新建一个groovy用例文件，增加若干<code>Action</code>用于测试，Action将在后续章节具体说明</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="action">Action<a href="#action" class="hash-link" aria-label="Action的直接链接" title="Action的直接链接">​</a></h2><p>Action是一个测试框架默认提供的测试行为，使用DSL来定义。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-action">sql action<a href="#sql-action" class="hash-link" aria-label="sql action的直接链接" title="sql action的直接链接">​</a></h3><p>sql action用于提交sql并获取结果，如果查询失败则会抛出异常</p><p>参数如下</p><ul><li>String sql: 输入的sql字符串</li><li><code>return List&lt;List&lt;Object&gt;&gt;</code>: 查询结果，如果是DDL/DML，则返回一行一列，唯一的值是updateRowCount</li></ul><p>下面的样例代码存放于<code>${DORIS_HOME}/regression-test/suites/demo/sql_action.groovy</code>:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">suite(&quot;sql_action&quot;, &quot;demo&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // execute sql and ignore result</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sql &quot;show databases&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // execute sql and get result, outer List denote rows, inner List denote columns in a single row</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    List&lt;List&lt;Object&gt;&gt; tables = sql &quot;show tables&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // assertXxx() will invoke junit5&#x27;s Assertions.assertXxx() dynamically</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertTrue(tables.size() &gt;= 0) // test rowCount &gt;= 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // syntax error</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql &quot;a b c d e&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        throw new IllegalStateException(&quot;Should be syntax error&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    } catch (java.sql.SQLException t) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def testTable = &quot;test_sql_action1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql &quot;DROP TABLE IF EXISTS ${testTable}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // multi-line sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        def result1 = sql &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        CREATE TABLE IF NOT EXISTS ${testTable} (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            id int</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        DISTRIBUTED BY HASH(id) BUCKETS 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          &quot;replication_num&quot; = &quot;1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        ) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // DDL/DML return 1 row and 1 column, the only value is update row count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(result1.size() == 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(result1[0].size() == 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(result1[0][0] == 0, &quot;Create table should update 0 rows&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        def result2 = sql &quot;INSERT INTO test_sql_action1 values(1), (2), (3)&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(result2.size() == 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(result2[0].size() == 1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        assertTrue(result2[0][0] == 3, &quot;Insert should update 3 rows&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    } finally {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        /**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         * try_xxx(args) means:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         * try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         *    return xxx(args)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         * } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         *     // do nothing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         *     return null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         * }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_sql(&quot;DROP TABLE IF EXISTS ${testTable}&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // you can see the error sql will not throw exception and return</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            def errorSqlResult = try_sql(&quot;a b c d e f g&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertTrue(errorSqlResult == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertTrue(false, &quot;Never catch exception&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // order_sql(sqlStr) equals to sql(sqlStr, isOrder=true)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // sort result by string dict</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def list = order_sql &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(null, list[0][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(1, list[1][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(15, list[2][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(2, list[3][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(3, list[4][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="qt-action">qt action<a href="#qt-action" class="hash-link" aria-label="qt action的直接链接" title="qt action的直接链接">​</a></h3><p>qt action用于提交sql，并使用对应的.out TSV文件来校验结果</p><ul><li>String sql: 输入sql字符串</li><li>return void</li></ul><p>下面的样例代码存放于<code>${DORIS_HOME}/regression-test/suites/demo/qt_action.groovy</code>:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">suite(&quot;qt_action&quot;, &quot;demo&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     * qt_xxx sql equals to quickTest(xxx, sql) witch xxx is tag.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     * the result will be compare to the relate file: ${DORIS_HOME}/regression_test/data/qt_action.out.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     * if you want to generate .out tsv file for real execute result. you can run with -genOut or -forceGenOut option.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     * e.g</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     *   ${DORIS_HOME}/run-regression-test.sh --run qt_action -genOut</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     *   ${DORIS_HOME}/run-regression-test.sh --run qt_action -forceGenOut</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    qt_select &quot;select 1, &#x27;beijing&#x27; union all select 2, &#x27;shanghai&#x27;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    qt_select2 &quot;select 2&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // order result by string dict then compare to .out file.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // order_qt_xxx sql equals to quickTest(xxx, sql, true).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    order_qt_union_all  &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-action">test action<a href="#test-action" class="hash-link" aria-label="test action的直接链接" title="test action的直接链接">​</a></h3><p>test action可以使用更复杂的校验规则来测试，比如验证行数、执行时间、是否抛出异常</p><p>可用参数</p><ul><li>String sql: 输入的sql字符串</li><li><code>List&lt;List&lt;Object&gt;&gt; result</code>: 提供一个List对象，用于比较真实查询结果与List对象是否相等</li><li><code>Iterator&lt;Object&gt; resultIterator</code>: 提供一个Iterator对象，用于比较真实查询结果与Iterator是否相等</li><li>String resultFile: 提供一个文件Uri(可以是本地文件相对路径，或http(s)路径)，用于比较真实查询结果与http响应流是否相等，格式与.out文件格式类似，但没有块头和注释</li><li>String exception: 校验抛出的异常是否包含某些字符串</li><li>long rowNum: 验证结果行数</li><li>long time: 验证执行时间是否小于这个值，单位是毫秒</li><li><code>Closure&lt;List&lt;List&lt;Object&gt;&gt;, Throwable, Long, Long&gt; check</code>: 自定义回调校验，可传入结果、异常、时间。存在回调函数时，其他校验方式会失效。</li></ul><p>下面的样例代码存放于<code>${DORIS_HOME}/regression-test/suites/demo/test_action.groovy</code>:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">suite(&quot;test_action&quot;, &quot;demo&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql &quot;abcdefg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // check exception message contains</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        exception &quot;errCode = 2, detailMessage = Syntax error&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            select *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            from (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 1 id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ) a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            order by id&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // multi check condition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // check return 2 rows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rowNum 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // execute time must &lt;= 5000 millisecond</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        time 5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // check result, must be 2 rows and 1 column, the first row is 1, second is 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        result(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            [[1], [2]]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql &quot;a b c d e f g&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // other check will not work because already declared a check callback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        exception &quot;aaaaaaaaa&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // callback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        check { result, exception, startTime, endTime -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // assertXxx() will invoke junit5&#x27;s Assertions.assertXxx() dynamically</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertTrue(exception != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql  &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                union all</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                select 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        check { result, ex, startTime, endTime -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // same as order_sql(sqlStr)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            result = sortRows(result)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(null, result[0][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(1, result[1][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(15, result[2][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(2, result[3][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(3, result[4][0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // execute sql and order query result, then compare to iterator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def selectValues = [1, 2, 3, 4]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        order true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql selectUnionAll(selectValues)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        resultIterator(selectValues.iterator())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // compare to data/demo/test_action.csv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    test {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        order true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql selectUnionAll(selectValues)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // you can set to http://xxx or https://xxx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // and compare to http response body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        resultFile &quot;test_action.csv&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="explain-action">explain action<a href="#explain-action" class="hash-link" aria-label="explain action的直接链接" title="explain action的直接链接">​</a></h3><p>explain action用来校验explain返回的字符串是否包含某些字符串</p><p>可用参数:</p><ul><li>String sql: 查询的sql，需要去掉sql中的explain</li><li>String contains: 校验explain是否包含某些字符串，可多次调用校验同时多个结果</li><li>String notContains: 校验explain是否不含某些字符串，可多次调用校验同时多个结果</li><li><code>Closure&lt;String&gt; check</code>: 自定义校验回调函数，可以获取返回的字符串，存在校验函数时，其他校验方式会失效</li><li><code>Closure&lt;String, Throwable, Long, Long&gt; check</code>: 自定义校验回调函数，可以额外获取异常和时间</li></ul><p>下面的样例代码存放于<code>${DORIS_HOME}/regression-test/suites/demo/explain_action.groovy</code>:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">suite(&quot;explain_action&quot;, &quot;demo&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    explain {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql(&quot;select 100&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // contains(&quot;OUTPUT EXPRS:&lt;slot 0&gt; 100\n&quot;) &amp;&amp; contains(&quot;PARTITION: UNPARTITIONED\n&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        contains &quot;OUTPUT EXPRS:&lt;slot 0&gt; 100\n&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        contains &quot;PARTITION: UNPARTITIONED\n&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    explain {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql(&quot;select 100&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // contains(&quot; 100\n&quot;) &amp;&amp; !contains(&quot;abcdefg&quot;) &amp;&amp; !(&quot;1234567&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        contains &quot; 100\n&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        notContains &quot;abcdefg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        notContains &quot;1234567&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    explain {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql(&quot;select 100&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // simple callback</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        check { explainStr -&gt; explainStr.contains(&quot;abcdefg&quot;) || explainStr.contains(&quot; 100\n&quot;) }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    explain {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        sql(&quot;a b c d e&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // callback with exception and time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        check { explainStr, exception, startTime, endTime -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // assertXxx() will invoke junit5&#x27;s Assertions.assertXxx() dynamically</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertTrue(exception != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="streamload-action">streamLoad action<a href="#streamload-action" class="hash-link" aria-label="streamLoad action的直接链接" title="streamLoad action的直接链接">​</a></h3><p>streamLoad action用于导入数据
可用参数为</p><ul><li>String db: db，默认值为regression-conf.groovy中的defaultDb</li><li>String table: 表名</li><li>String file: 要导入的文件路径，可以写data目录下的相对路径，或者写http url来导入网络文件</li><li><code>Iterator&lt;List&lt;Object&gt;&gt; inputIterator</code>: 要导入的迭代器</li><li>String inputText: 要导入的文本, 较为少用</li><li>InputStream inputStream: 要导入的字节流，较为少用</li><li>long time: 验证执行时间是否小于这个值，单位是毫秒</li><li>void set(String key, String value): 设置stream load的http请求的header，如label、columnSeparator</li><li><code>Closure&lt;String, Throwable, Long, Long&gt; check</code>: 自定义校验回调函数，可以获取返回结果、异常和超时时间。当存在回调函数时，其他校验项会失效。</li></ul><p>下面的样例代码存放于<code>${DORIS_HOME}/regression-test/suites/demo/streamLoad_action.groovy</code>:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">suite(&quot;streamLoad_action&quot;, &quot;demo&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def tableName = &quot;test_streamload_action1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sql &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            CREATE TABLE IF NOT EXISTS ${tableName} (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                id int,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                name varchar(255)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            DISTRIBUTED BY HASH(id) BUCKETS 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PROPERTIES (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              &quot;replication_num&quot; = &quot;1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    streamLoad {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // you can skip declare db, because a default db already specify in ${DORIS_HOME}/conf/regression-conf.groovy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // db &#x27;regression_test&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        table tableName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // default label is UUID:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // set &#x27;label&#x27; UUID.randomUUID().toString()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // default column_separator is specify in doris fe config, usually is &#x27;\t&#x27;.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // this line change to &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        set &#x27;column_separator&#x27;, &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // relate to ${DORIS_HOME}/regression-test/data/demo/streamload_input.csv.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // also, you can stream load a http stream, e.g. http://xxx/some.csv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        file &#x27;streamload_input.csv&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        time 10000 // limit inflight 10s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // stream load action will check result, include Success status, and NumberTotalRows == NumberLoadedRows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // stream load 100 rows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def rowCount = 100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // range: [0, rowCount)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // or rangeClosed: [0, rowCount]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def rowIt = range(0, rowCount)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            .mapToObj({i -&gt; [i, &quot;a_&quot; + i]}) // change Long to List&lt;Long, String&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            .iterator()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    streamLoad {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        table tableName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // also, you can upload a memory iterator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        inputIterator rowIt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // if declared a check callback, the default check condition will ignore.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // So you must check all condition</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        check { result, exception, startTime, endTime -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (exception != null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                throw exception</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            log.info(&quot;Stream load result: ${result}&quot;.toString())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            def json = parseJson(result)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(&quot;success&quot;, json.Status.toLowerCase())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertEquals(json.NumberTotalRows, json.NumberLoadedRows)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            assertTrue(json.NumberLoadedRows &gt; 0 &amp;&amp; json.LoadBytes &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他action">其他Action<a href="#其他action" class="hash-link" aria-label="其他Action的直接链接" title="其他Action的直接链接">​</a></h3><p>thread, lazyCheck, events, connect, selectUnionAll
具体可以在这个目录找到例子: <code>${DORIS_HOME}/regression-test/suites/demo</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动脚本例子">启动脚本例子<a href="#启动脚本例子" class="hash-link" aria-label="启动脚本例子的直接链接" title="启动脚本例子的直接链接">​</a></h2><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 查看脚本参数说明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh h</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 查看框架参数说明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -h</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试所有用例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 删除测试框架编译结果和测试日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --clean</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试suiteName为sql_action的用例, 目前suiteName等于文件名前缀，例子对应的用例文件是sql_action.groovy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run sql_action </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试suiteName包含&#x27;sql&#x27;的用例，**注意需要用单引号括起来**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;*sql*&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试demo和performance group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -g </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;demo,performance&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试demo group下的sql_action</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -g demo -s sql_action</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试demo目录下的sql_action</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -d demo -s sql_action</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 测试demo目录下用例，排除sql_action用例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -d demo -xs sql_action</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 排除demo目录的用例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -xd demo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 排除demo group的用例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -xg demo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 自定义配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -conf </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">a</span><span class="token operator">=</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 并发执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run -parallel </span><span class="token number">5</span><span class="token plain"> -suiteParallel </span><span class="token number">10</span><span class="token plain"> -actionParallel </span><span class="token number">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用查询结果自动生成out文件">使用查询结果自动生成.out文件<a href="#使用查询结果自动生成out文件" class="hash-link" aria-label="使用查询结果自动生成.out文件的直接链接" title="使用查询结果自动生成.out文件的直接链接">​</a></h2><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 使用查询结果自动生成sql_action用例的.out文件，如果.out文件存在则忽略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run sql_action -genOut</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 使用查询结果自动生成sql_action用例的.out文件，如果.out文件存在则覆盖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./run-regression-test.sh --run sql_action -forceGenOut</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="suite插件">Suite插件<a href="#suite插件" class="hash-link" aria-label="Suite插件的直接链接" title="Suite插件的直接链接">​</a></h2><p>有的时候我们需要拓展Suite类，但不便于修改Suite类的源码，则可以通过插件来进行拓展。默认插件目录为<code>${DORIS_HOME}/regression-test/plugins</code>，在其中可以通过groovy脚本定义拓展方法，以<code>plugin_example.groovy</code>为例，为Suite类增加了testPlugin函数用于打印日志：</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.doris.regression.suite.Suite</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// register `testPlugin` function to Suite,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// and invoke in ${DORIS_HOME}/regression-test/suites/demo/test_plugin.groovy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Suite.metaClass.testPlugin = { String info /* param */ -&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // which suite invoke current function?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Suite suite = delegate as Suite</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // function body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    suite.getLogger().info(&quot;Test plugin: suiteName: ${suite.name}, info: ${info}&quot;.toString())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // optional return value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;OK&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logger.info(&quot;Added &#x27;testPlugin&#x27; function to Suite&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>增加了testPlugin函数后，则可以在普通用例中使用它，以<code>${DORIS_HOME}/regression-test/suites/demo/test_plugin.groovy</code>为例:</p><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">suite(&quot;test_plugin&quot;, &quot;demo&quot;) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // register testPlugin function in ${DORIS_HOME}/regression-test/plugins/plugin_example.groovy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    def result = testPlugin(&quot;message from suite&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    assertEquals(&quot;OK&quot;, result)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cicd的支持">CI/CD的支持<a href="#cicd的支持" class="hash-link" aria-label="CI/CD的支持的直接链接" title="CI/CD的支持的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="teamcity">TeamCity<a href="#teamcity" class="hash-link" aria-label="TeamCity的直接链接" title="TeamCity的直接链接">​</a></h3><p>TeamCity可以通过stdout识别Service Message。当使用<code>--teamcity</code>参数启动回归测试框架时，回归测试框架就会在stdout打印TeamCity Service Message，TeamCity将会自动读取stdout中的事件日志，并在当前流水线中展示<code>Tests</code>，其中会展示测试的test及其日志。
因此只需要配置下面一行启动回归测试框架的命令即可。其中<code>-Dteamcity.enableStdErr=false</code>可以让错误日志也打印到stdout中，方便按时间顺序分析日志。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">JAVA_OPTS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;-Dteamcity.enableStdErr=</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${enableStdErr}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> ./run-regression-test.sh --teamcity --run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="外部数据源-e2e-测试">外部数据源 e2e 测试<a href="#外部数据源-e2e-测试" class="hash-link" aria-label="外部数据源 e2e 测试的直接链接" title="外部数据源 e2e 测试的直接链接">​</a></h2><p>Doris 支持一些外部署数据源的查询。所以回归框架也提供了通过 Docker Compose 搭建外部数据源的功能，以提供 Doris 对外部数据源的 e2e 测试。</p><ol start="0"><li><p>准备工作</p><p>在启动 Docker 前，请先修改 <code>docker/thirdparties/custom_settings.env</code> 文件中的 <code>CONTAINER_UID</code> 变量。</p><p>可以修改为如：<code>doris-10002-18sda1-</code>。</p><p>之后的启动脚本会，将 docker compose 中对应的名称进行替换，这样可以保证多套 containers 环境的容器名称和网络不会冲突。</p></li><li><p>启动 Container</p><p> Doris 目前支持 es, mysql, pg, hive, sqlserver, oracle, iceberg, hudi, trino 等数据源的 Docker compose。相关文件存放在 <code>docker/thirdparties/docker-compose</code> 目录下。</p><p> 默认情况下，可以直接通过以下命令启动所有外部数据源的 Docker container：
（注意，hive和hudi container 需要下载预制的数据文件，请参阅下面 hive和hudi 相关的文档。）</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd docker/thirdparties &amp;&amp; sh run-thirdparties-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 该命令需要 root 或 sudo 权限。命令返回成功，则代表所有 container 启动完成。可以通过 <code>docker ps -a</code> 命令查看。</p><p> 可以通过以下命令停止所有 container：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd docker/thirdparties &amp;&amp; sh run-thirdparties-docker.sh --stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 也可以通过以下命令启动或停止指定的组件：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd docker/thirdparties</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 启动 mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sh run-thirdparties-docker.sh -c mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 启动 mysql,pg,iceberg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sh run-thirdparties-docker.sh -c mysql,pg,iceberg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 停止 mysql,pg,iceberg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sh run-thirdparties-docker.sh -c mysql,pg,iceberg --stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>MySQL</p><p> MySQL 相关的 Docker compose 文件存放在 docker/thirdparties/docker-compose/mysql 下。</p><ul><li><code>mysql-5.7.yaml.tpl</code>：Docker compose 文件模板，无需修改。默认用户名密码为 root/123456</li><li><code>mysql-5.7.env</code>：配置文件，其中可以配置 MySQL container 对外暴露的端口，默认为 3316。</li><li><code>init/</code>：该目录存放的 sql 文件会在 container 创建后自动执行。目前默认会创建库、表并插入少量数据。</li><li><code>data/</code>：container 启动后挂载的本地数据目录，<code>run-thirdparties-docker.sh</code> 脚本会在每次启动时，自动清空并重建这个目录。</li></ul></li><li><p>Postgresql</p><p> Postgresql 相关的 Docker compose 文件存放在 docker/thirdparties/docker-compose/postgresql 下。</p><ul><li><code>postgresql-14.yaml.tpl</code>：Docker compose 文件模板，无需修改。默认用户名密码为 postgres/123456</li><li><code>postgresql-14.env</code>：配置文件，其中可以配置 Postgresql container 对外暴露的端口，默认为 5442。</li><li><code>init/</code>：该目录存放的 sql 文件会在 container 创建后自动执行。目前默认会创建库、表并插入少量数据。</li><li><code>data/</code>：container 启动后挂载的本地数据目录，<code>run-thirdparties-docker.sh</code> 脚本会在每次启动时，自动清空并重建这个目录。</li></ul></li><li><p>Hive</p><p> Hive 相关的 Docker compose 文件存放在 docker/thirdparties/docker-compose/hive 下。</p><ul><li><p><code>hive-2x.yaml.tpl</code>：Docker compose 文件模板，无需修改。</p></li><li><p><code>hadoop-hive.env.tpl</code>：配置文件的模板，无需修改。</p></li><li><p><code>gen_env.sh</code>：初始化配置文件的脚本，可以在其中修改：<code>FS_PORT</code> 和 <code>HMS_PORT</code> 两个对外端口，分别对应 defaultFs 和 Hive metastore 的端口。默认为 8120 和 9183。<code>run-thirdparties-docker.sh</code> 启动时会自动调用这个脚本。</p></li><li><p><code>scripts/</code> 目录会在 container 启动后挂载到 container 中。其中的文件内容无需修改。但须注意，在启动 container 之前，需要先下载预制文件：</p><p>  将 <code>https://doris-build-hk-1308700295.cos.ap-hongkong.myqcloud.com/regression/load/tpch1_parquet/tpch1.db.tar.gz</code> 文件下载到 <code>scripts/</code> 目录并解压即可。 </p></li></ul></li><li><p>Elasticsearch</p><p> 包括 ES6，ES7，ES8 三个版本的 docker 镜像，存放在 docker/thirdparties/docker-compose/elasticsearch/ 下。</p><ul><li><code>es.yaml.tpl</code>：Docker compose 文件模板。包括 ES6，ES7，ES8 三个版本。无需修改。</li><li><code>es.env</code>：配置文件，需配置 ES 的端口号。</li><li><code>scripts</code> 目录下存放了启动镜像后的初始化脚本。</li></ul></li><li><p>Oracle</p><p> 提供 Oracle 11 镜像，存放在 docker/thirdparties/docker-compose/oracle/ 下。</p><ul><li><code>oracle-11.yaml.tpl</code>：Docker compose 文件模板。无需修改。</li><li><code>oracle-11.env</code>：配置 Oracle 对外端口，默认为 1521。</li></ul></li><li><p>SQLServer</p><p> 提供 SQLServer 2022 镜像，存放在 docker/thirdparties/docker-compose/sqlserver/ 下。</p><ul><li><code>sqlserver.yaml.tpl</code>：Docker compose 文件模板。无需修改。</li><li><code>sqlserver.env</code>：配置 SQLServer 对外端口，默认为 1433。</li></ul></li><li><p>ClickHouse</p><p>提供 ClickHouse 22 镜像，存放在 docker/thirdparties/docker-compose/clickhouse/ 下。</p><ul><li><code>clickhouse.yaml.tpl</code>：Docker compose 文件模板。无需修改。</li><li><code>clickhouse.env</code>：配置 ClickHouse 对外端口，默认为 8123。</li></ul></li><li><p>Iceberg</p><p>提供 Iceberg + Spark + Minio 镜像组合。存放在 docker/thirdparties/docker-compose/iceberg/ 下。</p><ul><li><code>iceberg.yaml.tpl</code>：Docker compose 文件模板。无需修改。</li><li><code>entrypoint.sh.tpl</code>：镜像启动后的初始化脚本模板。无需修改。</li><li><code>spark-defaults.conf.tpl</code>：Spark 的配置文件模板。无需修改。</li><li><code>iceberg.env</code>：对外端口配置文件，需修改各个对外端口，避免端口冲突。</li></ul><p>启动后，可以通过如下命令启动 spark-sql</p><p><code>docker exec -it doris-xx-spark-iceberg spark-sql</code>        </p><p>其中 <code>doris-xx-spark-iceberg</code> 为 container 名称。</p><p>spark-sql iceberg 操作示例：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">create database db1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">show databases;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create table db1.test1(k1 bigint, k2 bigint, k3 string) partitioned by (k1);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">insert into db1.test1 values(1,2,&#x27;abc&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select * from db1.test1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">quit;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以通过 spark-shell 进行访问：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker exec -it doris-xx-spark-iceberg spark-shell</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(s&quot;create database db1&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(s&quot;show databases&quot;).show()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(s&quot;create table db1.test1(k1 bigint, k2 bigint, k3 string) partitioned by (k1)&quot;).show()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(s&quot;show tables from db1&quot;).show()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(s&quot;insert into db1.test1 values(1,2,&#x27;abc&#x27;)&quot;).show()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(s&quot;select * from db1.test1&quot;).show()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">:q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多使用方式可参阅 <a href="https://tabular.io/blog/docker-spark-and-iceberg/" target="_blank" rel="noopener noreferrer">Tabular 官方文档</a>。</p></li><li><p>Hudi</p><p>Hudi 相关的 Docker compose 文件存放在 docker/thirdparties/docker-compose/hudi 下。</p><ul><li><code>hudi.yaml.tpl</code>：Docker compose 文件模板，无需修改。</li><li><code>hadoop.env</code>：配置文件的模板，无需修改。</li><li><code>scripts/</code> 目录会在 container 启动后挂载到 container 中。其中的文件内容无需修改。但须注意，在启动 container 之前，需要先下载预制文件：
将 <code>https://doris-build-hk-1308700295.cos.ap-hongkong.myqcloud.com/regression/load/hudi/hudi_docker_compose_attached_file.zip</code> 文件下载到 <code>scripts/</code> 目录并解压即可。</li><li>启动前，可以将以下设置添加到<code>/etc/hosts</code>中，以避免出现<code>UnknownHostException</code>错误</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 adhoc-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 adhoc-2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 namenode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 datanode1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 hiveserver</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 hivemetastore</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">127.0.0.1 sparkmaster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动后，可以通过如下命令启动 hive query</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker exec -it adhoc-2 /bin/bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">beeline -u jdbc:hive2://hiveserver:10000 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hiveconf hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--hiveconf hive.stats.autogather=false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">show tables;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">show partitions stock_ticks_mor_rt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select symbol, max(ts) from stock_ticks_cow group by symbol HAVING symbol = &#x27;GOOG&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">select symbol, max(ts) from stock_ticks_mor_ro group by symbol HAVING symbol = &#x27;GOOG&#x27;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">exit;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也可以通过 spark-shell 进行访问：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker exec -it adhoc-1 /bin/bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$SPARK_INSTALL/bin/spark-shell \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --jars /var/scripts/hudi_docker_compose_attached_file/jar/hoodie-hive-sync-bundle.jar \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --master local[2] \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --driver-class-path $HADOOP_CONF_DIR \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --conf spark.sql.hive.convertMetastoreParquet=false \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --deploy-mode client \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --driver-memory 1G \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --executor-memory 3G \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --num-executors 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(&quot;show tables&quot;).show(100, false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(&quot;select symbol, max(ts) from stock_ticks_cow group by symbol HAVING symbol = &#x27;GOOG&#x27;&quot;).show(100, false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(&quot;select `_hoodie_commit_time`, symbol, ts, volume, open, close  from stock_ticks_cow where  symbol = &#x27;GOOG&#x27;&quot;).show(100, false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(&quot;select symbol, max(ts) from stock_ticks_mor_ro group by symbol HAVING symbol = &#x27;GOOG&#x27;&quot;).show(100, false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(&quot;select symbol, max(ts) from stock_ticks_mor_rt group by symbol HAVING symbol = &#x27;GOOG&#x27;&quot;).show(100, false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">spark.sql(&quot;select `_hoodie_commit_time`, symbol, ts, volume, open, close  from stock_ticks_mor_ro where  symbol = &#x27;GOOG&#x27;&quot;).show(100, false)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">:q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多使用方式可参阅 <a href="https://hudi.apache.org/docs/docker_demo" target="_blank" rel="noopener noreferrer">Hudi 官方文档</a>。</p></li><li><p>Trino
Trino 相关的 Docker compose 文件存放在 docker/thirdparties/docker-compose/trino 下。
模版文件：</p><ul><li>gen_env.sh.tpl ：用于生成 HDFS相关端口号，无需修改，若出现端口冲突，可以对端口号进行修改。</li><li>hive.properties.tpl ：用于配置trino catalog 信息，无需修改。</li><li>trino_hive.env.tpl ：Hive 的环境配置信息，无需修改。</li><li>trino_hive.yaml.tpl ：Docker compose 文件，无需修改。
启动 Trino docker 后，会配置一套 Trino + hive catalog 环境，此时 Trino 拥有两个catalog</li></ul><ol><li>hive</li><li>tpch（trino docker 自带）</li></ol><p>更多使用方式可参阅 <a href="https://trino.io/docs/current/installation/containers.html" target="_blank" rel="noopener noreferrer">Trino 官方文档</a></p></li></ol></li><li><p>运行回归测试</p><p>外表相关的回归测试默认是关闭的，可以修改 <code>regression-test/conf/regression-conf.groovy</code> 中的以下配置来开启：</p><ul><li><code>enableJdbcTest</code>：开启 jdbc 外表测试，需要启动 MySQL 和 Postgresql 的 container。</li><li><code>mysql_57_port</code> 和 <code>pg_14_port</code> 分别对应 MySQL 和 Postgresql 的对外端口，默认为 3316 和 5442。</li><li><code>enableHiveTest</code>：开启 hive 外表测试，需要启动 hive 的 container。</li><li><code>hms_port</code> 对应 hive metastore 的对外端口，默认为 9183。</li><li><code>enableEsTest</code>：开启 es 外表测试。需要启动 es 的 container。</li><li><code>es_6_port</code>：ES6 的端口。</li><li><code>es_7_port</code>：ES7 的端口。</li><li><code>es_8_port</code>：ES8 的端口。</li></ul></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-CN/community/developer-guide/github-checks"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Github 准入检查</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#测试步骤" class="table-of-contents__link toc-highlight">测试步骤</a></li><li><a href="#目录结构" class="table-of-contents__link toc-highlight">目录结构</a></li><li><a href="#框架默认配置" class="table-of-contents__link toc-highlight">框架默认配置</a></li><li><a href="#编写用例的步骤" class="table-of-contents__link toc-highlight">编写用例的步骤</a></li><li><a href="#action" class="table-of-contents__link toc-highlight">Action</a><ul><li><a href="#sql-action" class="table-of-contents__link toc-highlight">sql action</a></li><li><a href="#qt-action" class="table-of-contents__link toc-highlight">qt action</a></li><li><a href="#test-action" class="table-of-contents__link toc-highlight">test action</a></li><li><a href="#explain-action" class="table-of-contents__link toc-highlight">explain action</a></li><li><a href="#streamload-action" class="table-of-contents__link toc-highlight">streamLoad action</a></li><li><a href="#其他action" class="table-of-contents__link toc-highlight">其他Action</a></li></ul></li><li><a href="#启动脚本例子" class="table-of-contents__link toc-highlight">启动脚本例子</a></li><li><a href="#使用查询结果自动生成out文件" class="table-of-contents__link toc-highlight">使用查询结果自动生成.out文件</a></li><li><a href="#suite插件" class="table-of-contents__link toc-highlight">Suite插件</a></li><li><a href="#cicd的支持" class="table-of-contents__link toc-highlight">CI/CD的支持</a><ul><li><a href="#teamcity" class="table-of-contents__link toc-highlight">TeamCity</a></li></ul></li><li><a href="#外部数据源-e2e-测试" class="table-of-contents__link toc-highlight">外部数据源 e2e 测试</a></li></ul></div></div></div></div></main></div></div></div><div class="footer"><div class="container"><div class="footer-box"><div class="left"><img src="/zh-CN/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/zh-CN/images/asf_logo_apache.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/download">Download</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/learning">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">Blogs</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/users">User Stories</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community Support</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/team">Doris Team</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/community/how-to-contribute/">How to Contribute</a></li><li class="footer__item"><a href="https://github.com/apache/doris/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/doris/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Improvement Proposal<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/doris/issues/16392" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div><div class="right"><div class="footer__title">Connect with Us</div><div class="social-list"><div class="social"><a href="mailto:dev@doris.apache.org" target="_blank" title="mail" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.6003 6H26.3997C27.8186 6 28.982 7.10964 29 8.46946L16.0045 15.454L3.01202 8.47829C3.02405 7.11258 4.1784 6 5.6003 6ZM3.01202 11.1508L3 23.5011C3 24.8756 4.16938 26 5.6003 26H26.3997C27.8306 26 29 24.8756 29 23.5011V11.145L16.3111 17.8028C16.1157 17.9058 15.8813 17.9058 15.6889 17.8028L3.01202 11.1508V11.1508Z" fill="currentColor"></path></svg></a><a href="https://github.com/apache/doris" target="_blank" title="github" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.0001 2.66675C8.63342 2.66675 2.66675 8.63341 2.66675 16.0001C2.66524 18.7991 3.54517 21.5276 5.1817 23.7983C6.81824 26.0691 9.12828 27.7668 11.7841 28.6508C12.4508 28.7668 12.7001 28.3668 12.7001 28.0161C12.7001 27.7001 12.6828 26.6508 12.6828 25.5334C9.33342 26.1508 8.46675 24.7174 8.20008 23.9668C8.04942 23.5828 7.40008 22.4001 6.83342 22.0828C6.36675 21.8334 5.70008 21.2161 6.81608 21.2001C7.86675 21.1828 8.61608 22.1668 8.86675 22.5668C10.0668 24.5828 11.9841 24.0161 12.7494 23.6668C12.8668 22.8001 13.2161 22.2174 13.6001 21.8841C10.6334 21.5508 7.53342 20.4001 7.53342 15.3001C7.53342 13.8494 8.04942 12.6507 8.90008 11.7161C8.76675 11.3827 8.30008 10.0161 9.03342 8.18275C9.03342 8.18275 10.1494 7.83342 12.7001 9.55075C13.7855 9.2495 14.907 9.09787 16.0334 9.10008C17.1668 9.10008 18.3001 9.24942 19.3668 9.54942C21.9161 7.81608 23.0334 8.18408 23.0334 8.18408C23.7668 10.0174 23.3001 11.3841 23.1668 11.7174C24.0161 12.6507 24.5334 13.8334 24.5334 15.3001C24.5334 20.4174 21.4174 21.5508 18.4508 21.8841C18.9334 22.3001 19.3508 23.1001 19.3508 24.3508C19.3508 26.1334 19.3334 27.5668 19.3334 28.0174C19.3334 28.3668 19.5841 28.7828 20.2508 28.6494C22.8975 27.7558 25.1973 26.0547 26.8266 23.7856C28.4559 21.5165 29.3327 18.7936 29.3334 16.0001C29.3334 8.63341 23.3668 2.66675 16.0001 2.66675V2.66675Z" fill="currentColor"></path></svg></a><a href="https://twitter.com/doris_apache" target="_blank" title="twitter" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 3H10.6067L29 29H21.3933L3 3ZM6.31485 4.69302L22.3127 27.307H25.6852L9.68727 4.69302H6.31485Z" fill="white"></path><path d="M14.202 18.8346L5.18225 29H3L13.2092 17.4314L14.202 18.8346ZM18.4342 14.0647L28.2518 3H25.9448L17.4314 12.6471L18.4342 14.0647Z" fill="white"></path></svg></a></div><div class="social"><a href="https://join.slack.com/t/apachedoriscommunity/shared_invite/zt-1x7x8fger-F7NoshFQn~djlvGdnEtxUQ" title="slack" target="_blank" class="item"><svg width="2em" height="2em" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_125_278)"><path d="M12.5875 16.6906C11.0844 16.6906 9.86562 17.9094 9.86562 19.4125V26.2375C9.86562 26.9594 10.1524 27.6517 10.6628 28.1622C11.1733 28.6726 11.8656 28.9594 12.5875 28.9594C13.3094 28.9594 14.0017 28.6726 14.5122 28.1622C15.0226 27.6517 15.3094 26.9594 15.3094 26.2375V19.4531C15.3094 17.9094 14.0906 16.6906 12.5875 16.6906ZM3 19.4531C3 20.175 3.28677 20.8673 3.79722 21.3778C4.30767 21.8882 4.99999 22.175 5.72187 22.175C6.44376 22.175 7.13608 21.8882 7.64653 21.3778C8.15698 20.8673 8.44375 20.175 8.44375 19.4531V16.7312H5.7625C4.25938 16.6906 3 17.9094 3 19.4531ZM12.5875 3C11.8656 3 11.1733 3.28677 10.6628 3.79722C10.1524 4.30767 9.86562 4.99999 9.86562 5.72187C9.86562 6.44376 10.1524 7.13608 10.6628 7.64653C11.1733 8.15698 11.8656 8.44375 12.5875 8.44375H15.3094V5.72187C15.3094 4.21875 14.0906 3 12.5875 3ZM5.72187 15.3094H12.5469C13.2688 15.3094 13.9611 15.0226 14.4715 14.5122C14.982 14.0017 15.2688 13.3094 15.2688 12.5875C15.2688 11.8656 14.982 11.1733 14.4715 10.6628C13.9611 10.1524 13.2688 9.86562 12.5469 9.86562H5.72187C4.99999 9.86562 4.30767 10.1524 3.79722 10.6628C3.28677 11.1733 3 11.8656 3 12.5875C3 13.3094 3.28677 14.0017 3.79722 14.5122C4.30767 15.0226 4.99999 15.3094 5.72187 15.3094ZM26.2375 9.86562C24.7344 9.86562 23.5156 11.0844 23.5156 12.5875V15.3094H26.2375C26.9594 15.3094 27.6517 15.0226 28.1622 14.5122C28.6726 14.0017 28.9594 13.3094 28.9594 12.5875C28.9594 11.8656 28.6726 11.1733 28.1622 10.6628C27.6517 10.1524 26.9594 9.86562 26.2375 9.86562ZM16.6906 5.72187V12.5875C16.6906 13.3094 16.9774 14.0017 17.4878 14.5122C17.9983 15.0226 18.6906 15.3094 19.4125 15.3094C20.1344 15.3094 20.8267 15.0226 21.3372 14.5122C21.8476 14.0017 22.1344 13.3094 22.1344 12.5875V5.72187C22.1344 4.99999 21.8476 4.30767 21.3372 3.79722C20.8267 3.28677 20.1344 3 19.4125 3C18.6906 3 17.9983 3.28677 17.4878 3.79722C16.9774 4.30767 16.6906 4.99999 16.6906 5.72187ZM22.1344 26.2781C22.1344 24.775 20.9156 23.5562 19.4125 23.5562H16.6906V26.2781C16.6906 27 16.9774 27.6923 17.4878 28.2028C17.9983 28.7132 18.6906 29 19.4125 29C20.1344 29 20.8267 28.7132 21.3372 28.2028C21.8476 27.6923 22.1344 27 22.1344 26.2781ZM26.2781 16.6906H19.4125C18.6906 16.6906 17.9983 16.9774 17.4878 17.4878C16.9774 17.9983 16.6906 18.6906 16.6906 19.4125C16.6906 20.1344 16.9774 20.8267 17.4878 21.3372C17.9983 21.8476 18.6906 22.1344 19.4125 22.1344H26.2375C27.7406 22.1344 28.9594 20.9156 28.9594 19.4125C29 17.9094 27.7812 16.6906 26.2781 16.6906Z" fill="currentColor"></path></g><defs><clipPath id="clip0_125_278"><rect width="26" height="26" fill="currentColor" transform="translate(3 3)"></rect></clipPath></defs></svg></a><a href="https://www.youtube.com/@apachedoris/channels" title="youtube" target="_blank" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_3462_1106)"><path d="M30.3048 7.66776C30.7927 8.14769 31.1465 8.74331 31.3319 9.39705C31.7949 11.91 32.0182 14.46 31.9988 17.0138C32.0164 19.558 31.7931 22.0982 31.3319 24.6017C31.1465 25.2554 30.7927 25.851 30.3048 26.3309C29.8169 26.8109 29.2115 27.1589 28.5469 27.3413C26.026 28 16.0142 28 16.0142 28C16.0142 28 5.97317 28 3.48158 27.3413C2.81702 27.1589 2.21154 26.8109 1.72366 26.3309C1.23579 25.851 0.882017 25.2554 0.696547 24.6017C0.22555 22.0991 -0.00754264 19.5589 0.000288097 17.0138C-0.00936809 14.4591 0.223732 11.9091 0.696547 9.39705C0.882017 8.74331 1.23579 8.14769 1.72366 7.66776C2.21154 7.18784 2.81702 6.83983 3.48158 6.65738C6.00118 5.9869 16.0142 6.00002 16.0142 6.00002C16.0142 6.00002 26.0526 6.00002 28.5469 6.65738C29.2115 6.83983 29.8169 7.18784 30.3048 7.66776ZM12 23L22 17.0092L12 11V23Z" fill="white"></path></g><defs><clipPath id="clip0_3462_1106"><rect width="32" height="32" fill="white"></rect></clipPath></defs></svg></a><a href="https://www.linkedin.com/company/doris-apache/" title="linkedin" target="_blank" class="item"><svg width="2rem" height="2rem" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.29925 26.9996H9.66738V11.6781H4.29925V26.9996ZM22.1628 11.1949C19.9409 11.1949 18.7157 11.9388 17.3054 13.7407V11.6777H11.9459V26.9996H17.305V18.6738C17.305 16.9168 18.145 15.1982 20.1535 15.1982C22.162 15.1982 22.6559 16.9164 22.6559 18.632V27H28V18.2902C28 12.2386 24.3854 11.1949 22.1628 11.1949ZM6.99325 4C5.3395 4 4 5.21047 4 6.7046C4 8.19759 5.3395 9.40617 6.99325 9.40617C8.6455 9.40617 9.985 8.19722 9.985 6.7046C9.985 5.21047 8.6455 4 6.99325 4Z" fill="white"></path></svg></a></div></div></div></div><div class="footer__copyright">Copyright © 2023 The Apache Software Foundation,Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License, Version 2.0</a>. Apache, Doris, Apache Doris, the Apache feather logo and the Apache Doris logo are trademarks of The Apache Software Foundation.</div></div></div></div>
<script src="https://cdnd.selectdb.com/zh-CN/assets/js/runtime~main.f53d34ae.js"></script>
<script src="https://cdnd.selectdb.com/zh-CN/assets/js/main.0e65d80f.js"></script>
</body>
</html>